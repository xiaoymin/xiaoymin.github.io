<!DOCTYPE html>
<html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <title>ç”Ÿäº§ç¯å¢ƒå¦‚ä½•å±è”½Knife4jã€Swaggerç­‰Uièµ„æºå’Œæ¥å£ &mdash; å…«ä¸€èœåˆ€</title>
    <link rel="stylesheet" href="http://localhost:4000/assets/vendor/primer-css/css/primer.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/vendor/primer-markdown/dist/user-content.min.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/vendor/octicons/octicons/octicons.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/components/collection.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/components/repo-card.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/sections/repo-list.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/sections/mini-repo-list.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/components/boxed-group.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/globals/common.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/vendor/share.js/dist/css/share.min.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/globals/responsive.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/posts/index.css">
    <!-- Latest compiled and minified CSS -->
    

    
    <link rel="canonical" href="http://localhost:4000/2023/07/19/knife4j-production-forbidden-ui/">
    <link rel="alternate" type="application/atom+xml" title="å…«ä¸€èœåˆ€" href="http://localhost:4000/feed.xml">
    <link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
    
    <meta property="og:title" content="ç”Ÿäº§ç¯å¢ƒå¦‚ä½•å±è”½Knife4jã€Swaggerç­‰Uièµ„æºå’Œæ¥å£">
      
    <meta name="keywords" content="["knife4j", "å±è”½swagger", "å±è”½knife4j"]">
    <meta name="og:keywords" content="["knife4j", "å±è”½swagger", "å±è”½knife4j"]">
      
    <meta name="description" content="æœ¬æ–‡ä¸»è¦ä»‹ç»åœ¨ Spring Boot åº”ç”¨ä¸­,å¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒå±è”½Knife4jåŠç›¸å…³Swaggerèµ„æº">
    <meta name="og:description" content="æœ¬æ–‡ä¸»è¦ä»‹ç»åœ¨ Spring Boot åº”ç”¨ä¸­,å¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒå±è”½Knife4jåŠç›¸å…³Swaggerèµ„æº">
      
    
    
        
    
    <meta property="og:url" content="http://localhost:4000/2023/07/19/knife4j-production-forbidden-ui/">
    <meta property="og:site_name" content="å…«ä¸€èœåˆ€">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="zh_CN" />
    
    <meta property="article:published_time" content="2023-07-19">
    
    <script src="http://localhost:4000/assets/vendor/jquery/dist/jquery.min.js"></script>
    <script src="http://localhost:4000/assets/js/jquery-ui.js"></script>
    <script src="http://localhost:4000/assets/js/main.js"></script>
</head>
<body class="" data-mz="">
    <header class="site-header">
        <div class="container">
            <h1><a href="http://localhost:4000/" title="å…«ä¸€èœåˆ€"><span class="octicon octicon-mark-github"></span> å…«ä¸€èœåˆ€</a></h1>
            <button class="collapsed mobile-visible" type="button" onclick="toggleMenu();">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <nav class="site-header-nav" role="navigation">
                
                <a href="http://localhost:4000/" class=" site-header-nav-item" target="" title="é¦–é¡µ">é¦–é¡µ</a>
                
                <a href="http://localhost:4000/categories/" class=" site-header-nav-item" target="" title="åˆ†ç±»">åˆ†ç±»</a>
                
                <a href="http://localhost:4000/archives/" class=" site-header-nav-item" target="" title="å½’æ¡£">å½’æ¡£</a>
                
                <a href="http://localhost:4000/about/" class=" site-header-nav-item" target="" title="å…³äº">å…³äº</a>
                
            </nav>
        </div>
    </header>
    <!-- / header -->

    <section class="collection-head small geopattern" data-pattern-id="ç”Ÿäº§ç¯å¢ƒå¦‚ä½•å±è”½Knife4j">
<div class="container">
  <div class="columns">
    <div class="column three-fourths">
      <div class="collection-title">
        <h1 class="collection-header">ç”Ÿäº§ç¯å¢ƒå¦‚ä½•å±è”½Knife4jã€Swaggerç­‰Uièµ„æºå’Œæ¥å£</h1>
        <div class="collection-info">
          
          <span class="meta-info">
            <span class="octicon octicon-calendar"></span> 2023/07/19
          </span>
          
          
          <span class="meta-info">
            <span class="octicon octicon-file-directory"></span>
            <a href="http://localhost:4000/categories/#Knife4j" title="Knife4j">Knife4j</a>
          </span>
          
          <span class="meta-info">
            <!--<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>-->
            <span id="busuanzi_container_page_pv"> æµè§ˆ<span id="busuanzi_value_page_pv"></span>æ¬¡</span>
          </span>
        </div>
      </div>
    </div>
  </div>
</div>
</section>
<!-- / .banner -->
<section class="container content">
<div class="columns">
  <div class="column three-fourths" >
    <article class="article-content markdown-body">
    <p>æœ¬æ–‡ä¸»è¦ä»‹ç»åœ¨ Spring Boot åº”ç”¨ä¸­,å¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒå±è”½Knife4jåŠç›¸å…³Swaggerèµ„æº</p>

<p>å…³è”Issuesï¼š</p>

<ul>
  <li>âœ… <a href="https://gitee.com/xiaoym/knife4j/issues/I67JDM">å¼€å¯ç”Ÿäº§ç¯å¢ƒ,å±è”½æ‰€æœ‰èµ„æºæ¥å£</a></li>
  <li>âœ… <a href="https://gitee.com/xiaoym/knife4j/issues/I4XDYE">ç”Ÿäº§ç¯å¢ƒå±è”½bug</a></li>
  <li>âœ… <a href="https://gitee.com/xiaoym/knife4j/issues/I2810R">3.0.2 é…ç½®ç”Ÿäº§ç¯å¢ƒå±è”½åï¼Œä¾ç„¶å¯ä»¥è®¿é—®éƒ¨åˆ†æ¥å£</a></li>
  <li>âœ… <a href="https://gitee.com/xiaoym/knife4j/issues/IYSZE">ymlæ ¼å¼ å±è”½Swaggeræ‰€æœ‰èµ„æºï¼Œä¸ç”Ÿæ•ˆ</a></li>
  <li>âœ… <a href="https://gitee.com/xiaoym/knife4j/issues/IP1HK">ç”Ÿäº§ç¯å¢ƒswagger-uiå±è”½</a></li>
  <li>âœ… <a href="https://gitee.com/xiaoym/knife4j/issues/ISBVR">å¼€å¯ç”Ÿäº§ç¯å¢ƒ,å±è”½Swaggeræ‰€æœ‰èµ„æºæ¥å£ å»ºè®®</a></li>
  <li>âœ… <a href="https://gitee.com/xiaoym/knife4j/issues/I4Z2Z6">ç”Ÿäº§ç¯å¢ƒå±è”½é…ç½®&amp;2.0.9ç‰ˆæœ¬é—®é¢˜</a></li>
  <li>âœ… <a href="https://github.com/xiaoymin/knife4j/issues/578">4.1.0 basic éªŒè¯ï¼Œ ä»»æ„è¯·æ±‚éƒ½ä¼šå¯¼è‡´è¯·æ±‚é€šè¿‡ï¼Œä»è€Œå¯¼è‡´doc.html ä¸æç¤ºéªŒè¯</a></li>
  <li>âœ… <a href="https://github.com/xiaoymin/knife4j/issues/338">springcloud ç”Ÿäº§ç¯å¢ƒæ— æ³•å…³é—­</a></li>
  <li>â€¦â€¦</li>
</ul>

<p>ğŸ–ï¸ æœ¬æ–‡ä»“åº“ï¼š<a href="https://github.com/xiaoymin/knife4j-demo/tree/master/knife4j-forbidden-api">knife4j-forbidden-api</a></p>

<p>ä»ä»“åº“çš„issuesä¸­ä¸éš¾å‘ç°ï¼Œè¯¥éœ€æ±‚ç¡®ç¡®å®å®å­˜åœ¨ï¼Œè™½ç„¶åœ¨Knife4jä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¹¶æ²¡æœ‰æä¾›å±è”½èµ„æºç›¸å…³çš„é…ç½®ï¼Œä½†ä¹Ÿæœ‰å¾ˆå¤šå¼€å‘è€…æäº†å»ºè®®</p>

<p>è¿™åœ¨ä¹‹åçš„ç‰ˆæœ¬è¿­ä»£ä¸­,Knife4jä¸»è¦æä¾›äº†<a href="/docs/features/accessControl#352-è®¿é—®é¡µé¢åŠ æƒæ§åˆ¶">BasicéªŒè¯</a>å’Œ<a href="/docs/features/accessControl">Productionæš´åŠ›å±è”½</a>çš„æ‰‹æ®µï¼Œè¿™äº›éƒ½æ˜¯åŸºäºå®é™…éœ€æ±‚åœºæ™¯å‡ºå‘æ¥åšçš„,ç”Ÿäº§ç¯å¢ƒå±è”½æ¥å£æè¿°ä¹Ÿæ˜¯ä¸ºäº†ä¿æŠ¤åº”ç”¨ç¨‹åºå®‰å…¨çš„ä¸€ç§æ‰‹æ®µã€‚</p>

<p>æœ¬æ–‡ä¸»è¦ç«™åœ¨å®é™…éœ€æ±‚ä»¥åŠä¸šåŠ¡åœºæ™¯çš„è§’åº¦ï¼Œå»åˆ†æå¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒè¿›è¡Œå±è”½æ¥å£</p>

<p>ä»issuesä¸­ï¼Œæˆ‘ä»¬å±è”½çš„åœºæ™¯ä¸»è¦å‘ç”Ÿåœ¨ï¼š</p>

<ul>
  <li>âœ… å•ä½“Spring Bootåº”ç”¨å±è”½æ¥å£å’Œé™æ€uièµ„æº</li>
  <li>âœ… å¾®æœåŠ¡Spring Cloudã€Spring Cloud Gatewayç½‘å…³åœºæ™¯ä¸‹å±è”½æ¥å£å’Œé™æ€èµ„æº</li>
</ul>

<p>å±è”½çš„æ‰‹æ®µä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç§(æ¬¢è¿è¡¥å……):</p>

<ul>
  <li>ğŸŒ± åŸºäºSpring Bootæ¡†æ¶æä¾›çš„<code class="language-plaintext highlighter-rouge">@Conditional</code>æ¡ä»¶æ§åˆ¶ç›¸å…³<code class="language-plaintext highlighter-rouge">@Bean</code>çš„ç”Ÿæ•ˆ</li>
  <li>â›” åŸºäºServletä½“ç³»ä¸‹çš„Filterè¿‡æ»¤å™¨è¿›è¡Œæ‹¦æˆªå±è”½</li>
  <li>â›°ï¸ åŸºäºGatewayç½‘å…³ä½“ç³»ä¸‹çš„Filterè¿‡æ»¤å™¨è¿›è¡Œæ‹¦æˆªå±è”½</li>
  <li>ğŸ’€ åŸºäºMavené¡¹ç›®çš„jaræ’é™¤æœºåˆ¶ä»æ ¹æºè§£å†³é—®é¢˜</li>
  <li>ğŸ’£ åŸºäºç”Ÿäº§ç¯å¢ƒNginxã€Ingressç­‰æ§åˆ¶è¯·æ±‚è·¯å¾„å¤„ç†</li>
</ul>

<h2 id="1ç›®çš„">1.ç›®çš„</h2>

<p>é€šè¿‡å¼€å‘è€…æå‡ºçš„issuesï¼Œå±è”½çš„ç›®çš„åŠæä¾›BasicéªŒè¯çš„æ–¹æ¡ˆæ¥åˆ†æï¼Œæˆ‘è§‰å¾—ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p>

<ul>
  <li>ğŸ” ç”Ÿäº§ç¯å¢ƒä¸Šçº¿çš„ç³»ç»Ÿï¼Œå±è”½æ¥å£æè¿°æ€§è§„èŒƒï¼Œå¯¹äºç”Ÿäº§ç³»ç»Ÿæ˜¯ä¸€ç§<strong>å®‰å…¨ä¿æŠ¤æœºåˆ¶</strong></li>
  <li>ğŸ” Basicæ–¹æ¡ˆæ›´å¸Œæœ›çš„æ˜¯èƒ½å¤Ÿä¸Šçº¿åä¹Ÿä¿ç•™æ¥å£ï¼Œè§£å†³ç”Ÿäº§ç¯å¢ƒå‡ºé—®é¢˜æ—¶ä¾¿äºè°ƒè¯•å®šä½é—®é¢˜ï¼Œå½“Basicèƒ½èµ·åˆ°ä¸€å®šçš„å®‰å…¨é˜²æŠ¤ä½œç”¨</li>
</ul>

<h2 id="2è§£å†³æ–¹æ¡ˆ">2.è§£å†³æ–¹æ¡ˆ</h2>

<h3 id="21--åŸºäºspring-bootæ¡†æ¶æä¾›çš„conditionalæ¡ä»¶æ§åˆ¶ç›¸å…³beançš„ç”Ÿæ•ˆ">2.1 ğŸŒ± åŸºäºSpring Bootæ¡†æ¶æä¾›çš„<code class="language-plaintext highlighter-rouge">@Conditional</code>æ¡ä»¶æ§åˆ¶ç›¸å…³<code class="language-plaintext highlighter-rouge">@Bean</code>çš„ç”Ÿæ•ˆ</h3>

<p>åœ¨Spring Bootå¼€å‘æ¡†æ¶ä¸­ï¼Œæä¾›äº†ä¸€ç§æ¡ä»¶æ³¨å…¥çš„æœºåˆ¶æ³¨è§£<code class="language-plaintext highlighter-rouge">@Conditional</code>,é¡¾åæ€ä¹‰å°±æ˜¯å¯ä»¥æŒ‡å®šæˆ‘ä»¬çš„ä»£ç åœ¨ç‰¹å®šç¯å¢ƒæ‰ç”Ÿæ•ˆã€‚</p>

<p>å¼€å‘è€…åœ¨å†™ç¬¬ä¸‰æ–¹çš„starterçš„åŒ…æ—¶ï¼Œæ˜¯ä¸€ç§ç»å¸¸ä½¿ç”¨çš„æ‰‹æ®µã€‚æœ‰å…³<code class="language-plaintext highlighter-rouge">@Conditional</code>æ³¨è§£ç­‰æ¡ä»¶æ³¨å…¥çš„è¯´æ˜ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰åˆ†äº«çš„ä¸€ç¯‡Blog<a href="https://www.xiaominfo.com/blog/springboot/2020-09-23-spring-boot-conditional">ã€ŠSpring Bootæ¡†æ¶ä¸­å¦‚ä½•ä¼˜é›…çš„æ³¨å…¥å®ä½“Beanã€‹</a></p>

<p>æˆ‘ä»¬çš„éœ€æ±‚åœºæ™¯æ˜¯ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­èƒ½å¤Ÿå±è”½éƒ¨åˆ†æ¥å£ä»¥åŠUièµ„æºï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦å¯ä»¥ç»“åˆ<code class="language-plaintext highlighter-rouge">@Conditional</code>æ³¨è§£ä»¥åŠ<code class="language-plaintext highlighter-rouge">@Profile</code>æ³¨è§£æ¥å®ç°ä¸åŒç¯å¢ƒçš„<code class="language-plaintext highlighter-rouge">@Bean</code>åŠ è½½æœºåˆ¶å‘¢ï¼Ÿ</p>

<p>ç­”æ¡ˆå½“ç„¶æ˜¯å¯ä»¥çš„,è€ƒè™‘åˆ°åœ¨Spring Bootç¯å¢ƒä¸­å¤§éƒ¨åˆ†çš„ä¸­é—´ä»¶éƒ½æä¾›äº†é…ç½®åŒ–,ç±»ä¼¼<code class="language-plaintext highlighter-rouge">enable</code>å±æ€§æ¥å¼€å¯åŠ è½½é…ç½®ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">spring.profiles</code>é€šè¿‡é…ç½®è¿›è¡ŒåŒºåˆ†</p>

<p>ç®€å•çš„ä¾‹å­ï¼šæˆ‘ä»¬å¯¹äºKnife4jçš„é…ç½®æ–‡ä»¶æœ‰ä¸¤ä¸ªï¼Œåˆ†åˆ«å¯¹åº”devç¯å¢ƒå’Œprodç¯å¢ƒ</p>

<p>é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p>

<ul>
  <li>å¼€å‘ç¯å¢ƒ(dev)</li>
</ul>

<p>```yml title=â€application-dev.ymlâ€
knife4j:
  enable: true
  ## other propertiesâ€¦â€¦.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
- ç”Ÿäº§ç¯å¢ƒ(prod)

```yml title="application-prod.yml"
knife4j:
  enable: false
  ## other properties.......

</code></pre></div></div>

<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç¨‹åºåœ¨å¯åŠ¨æ—¶ï¼Œåªéœ€è¦é€šè¿‡è®¾å®šSpring Bootåº”ç”¨çš„<code class="language-plaintext highlighter-rouge">Profiles</code>ï¼Œå°±å¯ä»¥å®ç°æˆ‘ä»¬çš„æ¥å£æ— æ³•è®¿é—®ï¼Œå¦‚æœæˆ‘ä»¬æŒ‡å®š<code class="language-plaintext highlighter-rouge">prod</code>ç¯å¢ƒï¼Œé‚£ä¹ˆè®¿é—®æ–‡æ¡£æ—¶ï¼Œä¼šå‡ºç°æ¥å£404çš„æƒ…å†µ~</p>

<p><strong>æ€»ç»“ï¼š</strong>è¿™ç§æƒ…å†µæ˜¯å¯¹äºJavaåç«¯åº”ç”¨çš„<code class="language-plaintext highlighter-rouge">Configuration</code>ç±»çº§åˆ«çš„æ§åˆ¶ï¼Œé€šè¿‡Spring Bootæ¡†æ¶æä¾›çš„<code class="language-plaintext highlighter-rouge">@Conditional</code>æ³¨è§£æ¥è¾¾åˆ°æ¡ä»¶æ³¨å…¥åŠéƒ¨åˆ†ä»£ç å¯é…ç½®ç”Ÿæ•ˆçš„ç›®çš„</p>

<p>è™½ç„¶ç•Œé¢å¯è®¿é—®ï¼Œä½†æ˜¯å¯¹äºæ¥å£çš„è§„èŒƒæè¿°å¹¶æ²¡æœ‰ä½œç”¨ã€‚</p>

<h3 id="22--åŸºäºservletä½“ç³»ä¸‹çš„filterè¿‡æ»¤å™¨è¿›è¡Œæ‹¦æˆªå±è”½">2.2 â›” åŸºäºServletä½“ç³»ä¸‹çš„Filterè¿‡æ»¤å™¨è¿›è¡Œæ‹¦æˆªå±è”½</h3>

<p>åŸºäºServletä½“ç³»ä¸‹çš„Filterè¿‡æ»¤å™¨è¿›è¡Œæ‹¦æˆªå±è”½æ˜¯ä¸€ç§æ‹¦æˆªæœºåˆ¶ï¼Œä¸»è¦åˆ©ç”¨äº†Servletè§„èŒƒä¸‹çš„Filteræœºåˆ¶ï¼Œå¯¹æ‰€æœ‰çš„è¯·æ±‚èµ„æºè¿›è¡Œæ‹¦æˆªï¼Œå¼€å‘è€…å¯ä»¥å¯¹æ‰€æœ‰æ¶‰åŠåˆ°Knife4jã€Swaggerèµ„æºçš„è¯·æ±‚éƒ½è¿›è¡Œæ‹¦æˆªå±è”½</p>

<p>åœºæ™¯çš„èµ„æºæ‹¦æˆªåœ°å€å¯ä»¥å‚è€ƒæ–‡æ¡£<a href="/docs/features/accessControl">ã€Šè®¿é—®æƒé™æ§åˆ¶ã€‹</a></p>

<p>æˆ‘ä»¬çŸ¥é“äº†è¦å±è”½çš„èµ„æºï¼Œä»¥åŠFilteræœºåˆ¶ï¼Œæ­¤æ—¶ï¼Œå¼€å‘è€…å³å¯ä»¥è‡ªå·±å®ç°Filterä»£ç ï¼Œå¹¶å°†å…¶æ³¨å…¥åˆ°Spring Bootçš„åº”ç”¨æ¡†æ¶ä¸­æ¥å£</p>

<p>åœ¨Knife4jæä¾›çš„<a href="https://gitee.com/xiaoym/knife4j/blob/dev/knife4j/knife4j-openapi2-spring-boot-starter/src/main/java/com/github/xiaoymin/knife4j/spring/filter/ProductionSecurityFilter.java"><code class="language-plaintext highlighter-rouge">ProductionSecurityFilter.java</code></a> å¦‚ä¸‹ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">public</span> <span class="k">void</span> <span class="nx">doFilter</span><span class="p">(</span><span class="nx">ServletRequest</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">ServletResponse</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">FilterChain</span> <span class="nx">chain</span><span class="p">)</span> <span class="nx">throws</span> <span class="nx">IOException</span><span class="p">,</span> <span class="nx">ServletException</span> <span class="p">{</span>
    <span class="nx">HttpServletRequest</span> <span class="nx">httpServletRequest</span> <span class="o">=</span> <span class="p">(</span><span class="nx">HttpServletRequest</span><span class="p">)</span> <span class="nx">request</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">production</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">String</span> <span class="nx">uri</span> <span class="o">=</span> <span class="nx">httpServletRequest</span><span class="p">.</span><span class="nx">getRequestURI</span><span class="p">();</span>
        <span class="c1">// åŒ¹é…åˆ¤æ–­uriåœ°å€æ˜¯å¦æˆ‘ä»¬éœ€è¦å±è”½çš„èµ„æº</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">match</span><span class="p">(</span><span class="nx">uri</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">chain</span><span class="p">.</span><span class="nx">doFilter</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">HttpServletResponse</span> <span class="nx">resp</span> <span class="o">=</span> <span class="p">(</span><span class="nx">HttpServletResponse</span><span class="p">)</span> <span class="nx">response</span><span class="p">;</span>
            <span class="nx">resp</span><span class="p">.</span><span class="nx">setStatus</span><span class="p">(</span><span class="nx">customCode</span><span class="p">);</span>
            <span class="nx">resp</span><span class="p">.</span><span class="nx">sendError</span><span class="p">(</span><span class="nx">customCode</span><span class="p">,</span> <span class="dl">"</span><span class="s2">You do not have permission to access this page</span><span class="dl">"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">chain</span><span class="p">.</span><span class="nx">doFilter</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>   
</code></pre></div></div>

<h3 id="23-ï¸-åŸºäºgatewayç½‘å…³ä½“ç³»ä¸‹çš„filterè¿‡æ»¤å™¨è¿›è¡Œæ‹¦æˆªå±è”½">2.3 â›°ï¸ åŸºäºGatewayç½‘å…³ä½“ç³»ä¸‹çš„Filterè¿‡æ»¤å™¨è¿›è¡Œæ‹¦æˆªå±è”½</h3>

<p>åŸºäºGatewayç½‘å…³ä½“ç³»ä¸‹çš„Filterè¿‡æ»¤å™¨è¿›è¡Œæ‹¦æˆªå±è”½å’ŒServletä½“ç³»ä¸‹çš„Filterè¿›è¡Œæ‹¦æˆªæ˜¯åŒä¸€ç§æ€æƒ³ï¼Œå› ä¸ºSpring Cloud Gatewayæ˜¯åŸºäºNettyé©±åŠ¨è®¾è®¡å®ç°ï¼Œä½†æ€æƒ³æ–¹æ³•æ˜¯åŒä¸€ç§</p>

<p>æ— éæ˜¯ä½¿ç”¨Spring Cloud Gatewayæä¾›çš„Filteræ¥å£ï¼Œè‡ªå®šä¹‰å®ç°matchåå±è”½è¿‡æ»¤</p>

<p>å¯ä»¥å‚è€ƒKnife4jä»£ç ä¸­çš„<a href="https://gitee.com/xiaoym/knife4j/blob/dev/knife4j/knife4j-gateway-spring-boot-starter/src/main/java/com/github/xiaoymin/knife4j/spring/gateway/filter/basic/WebFluxSecurityBasicAuthFilter.java"><code class="language-plaintext highlighter-rouge">WebFluxSecurityBasicAuthFilter.java</code></a></p>

<h3 id="24--åŸºäºmavené¡¹ç›®çš„jaræ’é™¤æœºåˆ¶ä»æ ¹æºè§£å†³é—®é¢˜">2.4 ğŸ’€ åŸºäºMavené¡¹ç›®çš„jaræ’é™¤æœºåˆ¶ä»æ ¹æºè§£å†³é—®é¢˜</h3>

<p>è¯¥æ–¹æ³•ä¹Ÿæ˜¯åˆ©ç”¨Mavené¡¹ç›®æä¾›çš„Profilesæœºåˆ¶ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®æ‰“åŒ…æ„å»ºçš„æ—¶å€™ï¼Œå¯ä»¥å¯¹ä¸€äº›ä¸éœ€è¦çš„jaråŒ…è¿›è¡Œexclusionæ’é™¤ï¼Œæ¯”å¦‚Knife4jçš„uiåŒ…æˆ–è€…swaggerå®˜æ–¹uiåŒ…ï¼Œè¿™ç§jaråŒ…éƒ½æ˜¯webjarç±»å‹ï¼Œé‡Œé¢å…¨éƒ¨æ˜¯é™æ€èµ„æº</p>

<p><code class="language-plaintext highlighter-rouge">Maven</code>çš„<code class="language-plaintext highlighter-rouge">Profiles</code>æ˜¯ä¸€ç§é…ç½®ç®¡ç†æœºåˆ¶ï¼Œå…è®¸ä½ æ ¹æ®ä¸åŒçš„ç¯å¢ƒæˆ–æ¡ä»¶è®¾ç½®å’Œæ¿€æ´»ä¸åŒçš„æ„å»ºé…ç½®ã€‚å¯ä»¥ä½¿ç”¨Profilesæ¥å®šä¹‰ä¸€ç»„æ’ä»¶ã€ä¾èµ–é¡¹å’Œæ„å»ºé€‰é¡¹ï¼Œè¿™äº›é€‰é¡¹åœ¨ç‰¹å®šçš„æ„å»ºç¯å¢ƒä¸­ç”Ÿæ•ˆ</p>

<p>å¦‚æœæˆ‘ä»¬æƒ³åœ¨ç”Ÿäº§ç¯å¢ƒæ— éœ€è®¿é—®æä¾›å¤–éƒ¨å…¥å£ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨æ‰“åŒ…æ„å»ºçš„æ—¶å€™å¯ä»¥ç›´æ¥æ’é™¤å³å¯</p>

<p>åŸºäºè¿™ç§æ€æƒ³ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘åœ¨é¡¹ç›®çš„<code class="language-plaintext highlighter-rouge">pom.xml</code>ä¸­é…ç½®Mavençš„Profilesï¼Œé…ç½®å¦‚ä¸‹ï¼š</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;profiles&gt;</span>
    <span class="nt">&lt;profile&gt;</span>
        <span class="nt">&lt;id&gt;</span>dev<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;activation&gt;</span>
            <span class="c">&lt;!-- æ¿€æ´»æ¡ä»¶ä¸º"dev"ç³»ç»Ÿå±æ€§å­˜åœ¨ --&gt;</span>
            <span class="nt">&lt;property&gt;</span>
                <span class="nt">&lt;name&gt;</span>env<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;value&gt;</span>dev<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;/property&gt;</span>
        <span class="nt">&lt;/activation&gt;</span>
    <span class="nt">&lt;/profile&gt;</span>
    <span class="nt">&lt;profile&gt;</span>
        <span class="nt">&lt;id&gt;</span>prod<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;activation&gt;</span>
            <span class="c">&lt;!-- æ¿€æ´»æ¡ä»¶ä¸º"prod"ç¯å¢ƒå˜é‡å­˜åœ¨ --&gt;</span>
            <span class="nt">&lt;property&gt;</span>
                <span class="nt">&lt;name&gt;</span>env<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;value&gt;</span>prod<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;/property&gt;</span>
        <span class="nt">&lt;/activation&gt;</span>
        <span class="nt">&lt;dependencies&gt;</span>
            <span class="nt">&lt;dependency&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>com.github.xiaoymin<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>knife4j-openapi3-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;exclusions&gt;</span>
                    <span class="nt">&lt;exclusion&gt;</span>
                        <span class="nt">&lt;groupId&gt;</span>com.github.xiaoymin<span class="nt">&lt;/groupId&gt;</span>
                        <span class="nt">&lt;artifactId&gt;</span>knife4j-openapi3-ui<span class="nt">&lt;/artifactId&gt;</span>
                    <span class="nt">&lt;/exclusion&gt;</span>
                    <span class="nt">&lt;exclusion&gt;</span>
                        <span class="nt">&lt;groupId&gt;</span>org.webjars<span class="nt">&lt;/groupId&gt;</span>
                        <span class="nt">&lt;artifactId&gt;</span>swagger-ui<span class="nt">&lt;/artifactId&gt;</span>
                    <span class="nt">&lt;/exclusion&gt;</span>
                <span class="nt">&lt;/exclusions&gt;</span>

            <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;/dependencies&gt;</span>
    <span class="nt">&lt;/profile&gt;</span>
<span class="nt">&lt;/profiles&gt;</span>

</code></pre></div></div>

<p>åœ¨ä¸Šé¢çš„é…ç½®ä¸­ï¼Œä¸»è¦ä½œç”¨å¦‚ä¸‹ï¼š</p>

<ul>
  <li>âœ… å£°æ˜äº†ä¸¤ä¸ªProfileç±»å‹ï¼Œidåˆ†åˆ«ä¸º<code class="language-plaintext highlighter-rouge">dev</code>ã€<code class="language-plaintext highlighter-rouge">prod</code></li>
  <li>âœ… é…ç½®äº†ä¸¤ç§Profileç±»å‹çš„æ¿€æ´»æ¡ä»¶ï¼Œé€šè¿‡ç¯å¢ƒå˜é‡åç§°æ¥è¿›è¡ŒåŒºåˆ†</li>
  <li>âœ… åœ¨<code class="language-plaintext highlighter-rouge">prod</code>ç±»å‹ä¸‹é¢ï¼Œæˆ‘ä»¬é…ç½®çš„å¼•ç”¨jarçš„<code class="language-plaintext highlighter-rouge">exclusions</code>è§„åˆ™ï¼Œè¯¥Profileç±»å‹ä¸‹ä¼šæ’é™¤<code class="language-plaintext highlighter-rouge">knife4j-openapi3-ui</code>ã€<code class="language-plaintext highlighter-rouge">swagger-ui</code>è¿™ä¸¤ä¸ªjaråŒ…ï¼Œè€Œè¿™ä¸¤ä¸ªåŒ…åˆ†åˆ«æ˜¯Knife4jå’Œswaggerå®˜ç½‘æä¾›çš„Uièµ„æºåŒ…</li>
</ul>

<p>æ­¤æ—¶ï¼Œå½“æˆ‘ä»¬åœ¨é¡¹ç›®æ„å»ºæ‰“åŒ…æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¼ å…¥å˜é‡ï¼Œè¿›è¡Œæ„å»ºï¼Œæ’é™¤ç›¸å…³çš„jaråŒ…ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn clean package <span class="nt">-Pprod</span>
</code></pre></div></div>

<h3 id="25--åŸºäºç”Ÿäº§ç¯å¢ƒnginxingressç­‰æ§åˆ¶è¯·æ±‚è·¯å¾„å¤„ç†">2.5 ğŸ’£ åŸºäºç”Ÿäº§ç¯å¢ƒNginxã€Ingressç­‰æ§åˆ¶è¯·æ±‚è·¯å¾„å¤„ç†</h3>

<p>ä¸Šé¢2.1~2.4æä¾›çš„æ–¹æ¡ˆéƒ½æ˜¯é€šè¿‡ä»£ç æˆ–è€…å·¥ç¨‹ä¸Šè¿›è¡Œé…ç½®ä»¥è¾¾åˆ°ç›®çš„ï¼Œå¦‚æœæˆ‘ä»¬çš„æœåŠ¡å·²ç»ä¸Šçº¿ï¼Œä¸ç®¡æ˜¯Nginxæˆ–è€…åœ¨Kubernetesé›†ç¾¤ç¯å¢ƒä¸­ï¼Œéƒ½å¯ä»¥é€šè¿‡Nginxã€Ingressç­‰ä»£ç†æœåŠ¡å™¨è¿›è¡Œé…ç½®æ‹¦æˆªå¤„ç†</p>

<p>ä¹Ÿä¸å¤±ä¸ºä¸€ç§å¤„ç†æ–¹å¼ã€‚</p>

<p>åœ¨Nginxä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦é…ç½®æ‹¦æˆªèµ„æºæ¥å£ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
location /doc.html <span class="o">{</span>
    <span class="k">return </span>403<span class="p">;</span>  <span class="c"># è¿”å› 403 çŠ¶æ€ç è¡¨ç¤ºç¦æ­¢è®¿é—®</span>
<span class="o">}</span>

location /swagger-ui.html <span class="o">{</span>
    <span class="k">return </span>403<span class="p">;</span>  <span class="c"># è¿”å› 403 çŠ¶æ€ç è¡¨ç¤ºç¦æ­¢è®¿é—®</span>
<span class="o">}</span>

// å…¶ä»–è·¯ç”±æ¥å£åŠèµ„æº

</code></pre></div></div>

<p>è€Œåœ¨Kubernetesé›†ç¾¤ç¯å¢ƒä¸­ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨Ingressæ§åˆ¶è¯·æ±‚,é…ç½®ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">my-ingress</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">rules</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">http</span><span class="pi">:</span>
        <span class="na">paths</span><span class="pi">:</span>
        <span class="c1"># è½¬å‘doc.htmlåˆ°error-service,å¯ä»¥åœ¨è¯¥æœåŠ¡ä¸­å®šä¹‰ä¸€ä¸ªé”™è¯¯é¡µé¢æˆ–è¿”å›é€‚å½“çš„é”™è¯¯ç </span>
          <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s">/doc.html</span>
            <span class="na">pathType</span><span class="pi">:</span> <span class="s">Prefix</span>
            <span class="na">backend</span><span class="pi">:</span>
              <span class="na">service</span><span class="pi">:</span>
                <span class="na">name</span><span class="pi">:</span> <span class="s">error-service</span>
                <span class="na">port</span><span class="pi">:</span>
                  <span class="na">number</span><span class="pi">:</span> <span class="m">80</span>
</code></pre></div></div>

<h2 id="3æ€»ç»“">3.æ€»ç»“</h2>

<p>æœ¬æ–‡ä»å·¥ç¨‹ã€ä»£ç ç­‰å¤šæ–¹è§’åº¦ç»™å¤§å®¶æä¾›äº†ä¸€ç§è§£å†³æ€è·¯æ–¹æ¡ˆï¼Œå¸Œæœ›èƒ½å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ã€‚</p>

    </article>
    <div class="share">
      <div class="share-component"></div>
    </div>
    <div class="comment">
      

  

  
        <div id="gitalk-container"></div>
        <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
        <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
        <script>
        var gitalk = new Gitalk({
            id: '/2023/07/19/knife4j-production-forbidden-ui/',
            clientID: 'af23e0d8d5f41c7b3719',
            clientSecret: '822f4fcf8e75da6193bd6f26bab3111ecce89142',
            repo: 'blog-comments',
            owner: 'xiaoymin',
            admin: ['xiaoymin'],
            labels: ['gitment'],
            perPage: 50,
        })
        gitalk.render('gitalk-container')
        </script>
  


    </div>
  </div>
  <div class="column one-fourth">
    
<h3>ç«™å†…æœç´¢</h3>
<div id="site_search">
    <input type="text" id="search_box" placeholder="æœç´¢">
</div>

<ul id="search_results"></ul>

<link rel="stylesheet" type="text/css" href="http://localhost:4000/assets/css/modules/sidebar-search.css">
<script src="http://localhost:4000/assets/js/simple-jekyll-search.min.js"></script>
<script src="http://localhost:4000/assets/js/search.js"></script>

<script type="text/javascript">
SimpleJekyllSearch({
    searchInput: document.getElementById('search_box'),
    resultsContainer: document.getElementById('search_results'),
    json: 'http://localhost:4000/assets/search_data.json',
    searchResultTemplate: '<li><a href="{url}" title="{desc}">{title}</a></li>',
    noResultsText: 'No results found',
    limit: 10,
    fuzzy: false,
    exclude: ['Welcome']
})
</script>

    

    <div class="xiaoym-bot">
  <div class="xiaoym-qrcode-title">
    <h3>TorchV Botå¼€æ”¾è¯•ç”¨ä¸­......</h3>
  </div>
  <div style="text-align: center;">
    <a target="_blank" href="https://www.luxiangdong.com/2024/01/25/lanuch-1/?utm_source=xiaoymin"><img width="300"
        src="/images/website/bot/torchv_bot2.png" /></a>
  </div>
</div>
<div class="xiaoym-qrcode">
  <div class="xiaoym-qrcode-title">
    <h3>æœ€æ–°å†…å®¹,å…³æ³¨â€œå…«ä¸€èœåˆ€â€å…¬ä¼—å·</h3>
  </div>
  <div style="text-align: center;"><img src="/images/website/mp/qrcode_mini.jpg" /> </div>
</div>

<h3 class="post-directory-title mobile-hidden">Table of Contents</h3>
<div id="post-directory-module" class="mobile-hidden">
  <section class="post-directory">
    <!-- Links that trigger the jumping -->
    <!-- Added by javascript below -->
    <dl></dl>
  </section>
</div>


<script src="http://localhost:4000/assets/js/jquery.toc.js"></script>
  </div>
</div>
</section>
<!-- /section.content -->

    <footer class="container">
        <div class="site-footer" role="contentinfo">
            <div class="copyright left mobile-block">
                    Â© 2015
                    <span title="è‚–ç‰æ°‘">è‚–ç‰æ°‘</span>
                    <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a>
            </div>

            <ul class="site-footer-links right mobile-hidden">
                <li>
                    <a href="javascript:window.scrollTo(0,0)" >TOP</a>
                </li>
            </ul>
            <a href="https://github.com/xiaoymin/xiaoymin.github.io" target="_blank" aria-label="view source code">
                <span class="mega-octicon octicon-mark-github" title="GitHub"></span>
            </a>
            <ul class="site-footer-links mobile-hidden">
                
                <li>
                    <a href="http://localhost:4000/" title="é¦–é¡µ" target="">é¦–é¡µ</a>
                </li>
                
                <li>
                    <a href="http://localhost:4000/categories/" title="åˆ†ç±»" target="">åˆ†ç±»</a>
                </li>
                
                <li>
                    <a href="http://localhost:4000/archives/" title="å½’æ¡£" target="">å½’æ¡£</a>
                </li>
                
                <li>
                    <a href="http://localhost:4000/about/" title="å…³äº" target="">å…³äº</a>
                </li>
                
                <li><a href="http://localhost:4000/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li>
            </ul>

        </div>
        <div style="padding-bottom: 40px;
    font-size: 14px;
    height: 14px;
    vertical-align: middle;
    text-align: center;
    color: #999999;
    border-top: 1px solid #eee;">
            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <span id="busuanzi_container_site_uv"> <strong>è®¿å®¢æ•°</strong> <span id="busuanzi_value_site_uv"></span></span>
            <span id="busuanzi_container_site_pv"> <strong>è®¿é—®é‡</strong> <span id="busuanzi_value_site_pv"></span></span>
        </div>
    </footer>
    <div class="tools-wrapper">
      <a class="gotop" href="#" title="å›åˆ°é¡¶éƒ¨"><span class="octicon octicon-arrow-up"></span></a>
    </div>
    <!-- / footer -->
    <script src="http://localhost:4000/assets/vendor/share.js/dist/js/share.min.js"></script>
    <script src="http://localhost:4000/assets/js/geopattern.js"></script>
    <script src="http://localhost:4000/assets/js/prism.js"></script>
    <link rel="stylesheet" href="http://localhost:4000/assets/css/globals/prism.css">
    <script>
      jQuery(document).ready(function($) {
        // geopattern
        $('.geopattern').each(function(){
          $(this).geopattern($(this).data('pattern-id'));
        });
       // hljs.initHighlightingOnLoad();
      });
    </script>

    

    

    

    

    
</body>
</html>
